# Создайте следующие процедуры и функции:

## ЗАДАНИЕ 1 - ОСНОВЫ ЯЗЫКА PL/SQL
1.	Процедуру MY_PROCEDURE для вывода на экран фразы "My procedure works" ("Моя процедура работает").
2.	Процедуру для включения нового отдела в таблицу S_DEPT.
3.	Процедуру, обновляющую номер региона для существующего отдела.
4.	Процедуру для удаления отдела, созданного в предыдущем пункте.
5.	Процедуру NEW_EMP для включения записи о новом служащем в таблицу S_EMP.
6.	Процедуру, принимающую два числа через переменные. Первое нужно разделить на второе и к результату прибавить второе число. Результат должен быть записан в переменную PL/SQL и выведен на экран.
7.	Функцию, вычисляющую общее вознаграждение за год. Функции должны передаваться годовая зарплата и процент премиальных.  Премиальные необходимо преобразовать из целого числа в десятичное. Если зарплата не определена, то функция должна выдавать значение «ноль». Если премия не определена, функция должна выдавать только зарплату.

## ЗАДАНИЕ 2 - УПРАВЛЕНИЕ ПОТОКАМИ В БЛОКАХ PL/SQL
1.	Процедуру SET_COMM, которая устанавливает процент комиссионных для служащего в зависимости от общего объема продаж. Для подготовки к упражнению отмените действие ограничения для столбца COMISSION_PCT в таблице S_EMP. Проценты комиссионных в упражнении не будут удовлетворять ограничению.
 - Создайте параметр, чтобы можно было ввести номер служащего.
 - Подсчитайте сумму всех заказов, размещенным этим служащим.
 - Если эта сумма меньше 10000 установите процент комиссионных «10».
 - Если сумма находится в диапазоне от 10000 до 1000000, установите процент комиссионных «15».
 - Если в таблице S_ORD нет заказов, размещенных данным служащим, установите процент комиссионных «0».

2.	 Процедуру CUST_UPDATE с циклом для обработки кредитного рейтинга всех заказчиков по регионам. Не фиксируйте изменения:
 - Если номер региона четный, установите кредитный рейтинг “Exellent”, даже если он уже был таким; в противном случае установите кредитный рейтинг “Good”.
 - Когда строки будут обновлены, определите количество обновленных строк. В зависимости от того, каким будет это количество, выдайте на экран следующую информацию: Если обновлено менее трех срок, сообщение: “Fewer then 3 customer records updated for region number X”, где X – номер региона. В противном случае – “Y rows updated for region number X”, где Y – количество обновленных строк, X – номер региона. 
 - Отмените изменения. Задайте точку останова на проверке количества обновленных строк. 
 
3.	 Процедуру ZAKAZ_P с циклом для обработки общей суммы заказа покупателями. Для этого
 - Создайте таблицу ZAKAZ со следующими полями (id number, order_name varchar2, product_id number, quantity number, comment varchar2).
 - Для всех заказчиков, общая сумма заказов которых превышает 50000,  внесите данные в таблицу. Для задания первичного ключа создайте последовательность.
 - Для всех заказчиков не принадлежащих региону «Europe»  добавить комментарий «out region»
 - Проверить количество обновленных строк. Если были обновлены все строки, то вывести сообщение «нет заказчиков из европейского региона».
 
4.	Функцию вычисления либо общего количества лет, которые сотрудник проработал на фирме либо даты десятилетия его рабочей деятельности в зависимости от  флага.

5.	Процедуру, обрабатывающую данные по сотрудникам:
 - Создайте таблицу STAG со следующими полями (id number, emp_id, FIO varchar2, ord_id number, ord_name varchar2, commentar varchar2). Заполните таблицу данными, имеющимися в базе (используйте данные из таблиц). Для задания первичного ключа создайте последовательность.
 - Для всех сотрудников, внесенных в таблицу STAG,  с четными номерами добавьте в столбец комментария сообщение «стаж XXX лет», где XXX- вычисленное количество отработанных сотрудником лет.
 - Для всех сотрудников, внесенных в таблицу STAG,  с нечетными номерами добавьте в столбец комментария сообщение «До 10-тилетия раб. деят. Осталось XXX лет», где XXX – вычисленное количество лет, которые осталось проработать сотруднику до 10-тилетнего юбилея. 
 - Определить количество сотрудников, проработавших на фирме более 10 лет. Вывести сообщение «XXX сотрудников проработало на фирме более 10 лет», где XXX – вычисленное количество сотрудников. 
 - Если у сотрудника в текущую дату (sysdate) – юбилей, то вывести на экран следующее сообщение «Поздравляем СОТРУДНИК_ИМЯ с 10-тилетием его рабочей деятельности!»

## ЗАДАНИЕ 3 - ОБРАБОТКА ЗАПРОСОВ С ИСПОЛЬЗОВАНИЕМ КУРСОРОВ
1. Используя курсор, создайте процедуру TOP_DOGS1 для определения самых высокооплачиваемых   служащих
 1. Для этого упражнения создайте новую таблицу с данными о служащих и их заработной плате.
 1. Включите параметр, чтобы пользователь мог ввести нужное количество самых высокооплачиваемых служащих (n).
 1. Создайте цикл FOR с курсором для выборки из таблицы S_EMP фамилий и заработной платы n  самых высокооплачиваемых служащих.
 1. Сохраните фамилию и заработную плату в таблице TOP_DOGS.
 1. Предполагается что двух служащих с одинаковой заработной платой не существует.
 1. Проверьте особые случаи – например, с n=0 и с n, превышающим количество служащих в таблице S_EMP.
 1. После каждого теста удаляйте данные из таблицы TOP_DOGS.

2. Создайте хранимую процедуру ADD_STARS, которая в новом столбце STARS проставляет для каждого служащего по призовой звёздочке за каждый процент заработанных комиссионных.  Используйте курсор и цикл WHILE.
 1. Для этого упражнения создайте в таблице S_EMP новый столбец для хранения звёздочек (*)
 2. Определите процент комиссионных для каждого служащего, округлив его до ближайшего целого числа. Рассмотрите случай, когда служащий не получает комиссионных.
  3. Добавляйте звёздочку в строку звёздочек за каждый процент комиссионных. Если, например, служащий получает 10 процентов комиссионных, символьная строка в столбце STARS должна содержать десять звёздочек.
 4. Проставьте соответствующее количество звёздочек для каждого служащего в столбце STARS.
3.  Скопируйте процедуру TOP_DOGS1 из упражнения 1 и назовите новый вариант TOP_DOGS2. Измените процедуру TOP_DOGS2 с учётом случая, когда несколько служащих из упражнения 1 имеют одинаковую заработную плату. Для каждой фамилии в списке должны быть перечислены все служащие с такой же заработной платой.
Выполните процедуру TOP_DOGS2. В качестве n введите число 6, 7 или 8. В этом случае в выходных данных должны появиться фамилии Ngao, Dumas и Quick-To_See. Если же n равно 9, 10 или 11, должны появиться  фамилии Nagayama, Magee и Maduro.
Не забывайте полностью удалять данные из таблицы TOP_DOGS после каждого теста.
 
4. Напишите процедуру для печати фамилии служащих, чья заработная плата лежит в диапазоне плюс минус $100 от введённого значения. Используйте курсор для выбора служащих.
 1. Если служащего с такой заработной платой нет, пользователь должен получить соответствующее сообщение. Используйте исключение.
 1. Если служащих с такой зарплатой более 3, сообщение должно указывать, сколько сотрудников попадёт в этот диапазон зарплат.
 
5.     Используя курсор с параметром, создайте процедуру для определения:
 1. Сотрудников, работающих больше заданного числа лет.
 1. Для этих сотрудников определите менеджеров. Выведите без повторений полученный список менеджеров с указанием рядом с каждым именем через запятую имён сотрудников из начального списка.
 1. Определите и выведите на экран менеджеров, принявших суммарные заказы более заданной суммы.
 
6. Используя курсорную переменную (ref_cursor), напишите процедуру, определяющую рейтинг лучших товаров по:
 - суммарной цене приобретённого за указанный срок товара;
 - количеству единиц приобретённого за указанный срок товара;
 - количеству заказов, в которые входил приобретённого за указанный срок товар.
Т.е. первым выдаётся на печать товар, у которого максимальный показатель по выбранному критерию, затем товар с более низким показателем  и т.д.
Какой из критериев использовать определяется по входным параметрам. Если указано несколько критериев, то их приоритет соответствует списку, указанному выше. 

## ЗАДАНИЕ 4 - ОБРАБОТКА ИСКЛЮЧЕНИЙ, ВСТРОЕННЫЙ ДИНАМИЧЕСКИЙ SQL
1.	Создайте процедуру, которая бы обновляла номера регионов для служащих отделов. 
 - Напишите обработчик исключений, который будет выдавать сообщение о том, что указанный регион не существует
 - Напишите обработчик исключений, который бы выдавал пользователю сообщение о том, что для указанного региона уже есть отдел с таким названием
 - Напишите обработчик исключений, который выдавал бы пользователю сообщение о том, что указанный номер отдела не существует (используйте атрибут SQL%NOTFOUND  и возбудите исключение вручную). 

1. Напишите процедуру для вывода на фамилии и названия отдела для служащих, чья заработная плата лежит в диапазоне плюс-минус 100$ от введенного значения.
 - Напишите обработчик исключений, который будет выдавать сообщение о том, что служащих с такой зарплатой нет.
 - Напишите обработчик исключений, который будет выдавать сообщение о том, что служащих с такой зарплатой несколько. Сообщение должно указывать, сколько сотрудников попадает в этот диапазон зарплат.

1. Напишите процедуру, возвращающую список товаров, количество каждого товара и его цену. Процедура должна иметь два входных параметра - название фирмы и название товара. Если указано название фирмы, выдаётся список всех купленных ею товаров. Если указано название фирмы и дополнительно указано наименование товара, то выдаётся товар, купленный фирмой, наименование которого совпадает с заданным наименованием. Если указано только наименование товара, то выдаётся указанный товар.
Процедуру написать с использованием позиций предназначенных для размещения переменных PL/SQL, указываемых в предложении USING оператора EXECUTE IMMEDIATE.

